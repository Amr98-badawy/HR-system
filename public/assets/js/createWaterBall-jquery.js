!function(e){function a(e,a,t){var n=this.data("waterBall").config,c=document.createElement("canvas"),r=c.getContext("2d");c.width=n.cvs_config.width,c.height=n.cvs_config.height,r.save();var o=[];r.beginPath(),r.arc(n.circle_config.r,n.circle_config.r,n.circle_config.cR-5,0,2*Math.PI),r.clip(),r.closePath(),r.beginPath();for(var l=n.wave_config.sX,g=n.wave_config.waveWidth,f=n.wave_config.waveHeight,h=n.wave_config.axisLength,s=n.cvs_config.width,d=n.cvs_config.height,v=l;v<l+h;v+=20/h){var _=-Math.sin((l+v)*g+e),w=d*(1-n.nowRange/100);o.push([v,w+_*f]),r.lineTo(v,w+_*f)}r.lineTo(h,d),r.lineTo(l,d),r.lineTo(o[0][0],o[0][1]);var u=r.createLinearGradient(0,d,s,o[o.length-1][1]);if(u.addColorStop(0,a),u.addColorStop(1,t),r.fillStyle=u,r.fill(),r.restore(),!n.isLoading){r.save();var R=.4*n.circle_config.cR;r.font=R+"px Microsoft Yahei",r.textAlign="center",r.fillStyle=n.textColorRange[i.call(this)],r.fillText(~~n.nowRange+"%",n.circle_config.r,n.circle_config.r+R/2),r.restore()}return c}function t(){var e=this.data("waterBall").config,a=document.createElement("canvas"),t=a.getContext("2d");return a.width=e.cvs_config.width,a.height=e.cvs_config.height,t.lineWidth=e.lineWidth,t.beginPath(),t.strokeStyle=e.circle_line_color[i.call(this)],t.arc(e.circle_config.r,e.circle_config.r,e.circle_config.cR,0,2*Math.PI),t.stroke(),a}function i(){for(var e=this.data("waterBall").config,a=0,t=e.data_range;a<t.length;a++)if(e.nowRange<t[a])return a;return t.length-1}var n={init:function(a){return this.each((function(){var t=e(this),i={cvs_config:{width:220,height:220},wave_config:{sX:0,sY:110,waveWidth:.015,waveHeight:5,axisLength:220,speed:.09,xOffset:0},circle_config:{r:110,cR:105},isLoading:!1,nowRange:0,targetRange:0,lineWidth:2,data_range:[60,80,100],textColorRange:["#fb3960","#fff","#fff"],circle_line_color:["#FC6180","#FFB64D","#93BE52"],main_backcolor_range:[["#FC6180","#fc7a94"],["#FFB64D","#ffc067"],["#93BE52","#9fc565"]],backcolor_range:[["#fb3960","#fc486c"],["#ffa524","#ffac34"],["#7ea83f","#87b343"]]};if(!t.data("waterBall")){var c={},r={};a.cvs_config&&(c={sY:a.cvs_config.width/2,axisLength:a.cvs_config.width},r={r:a.cvs_config.width/2,cR:a.cvs_config.width/2-5}),e.extend(!0,i,{wave_config:c,circle_config:r},a);var o=document.createElement("canvas");o.width=i.cvs_config.width,o.height=i.cvs_config.height,t.html("").html(e(o)),t.data("waterBall",{canvas:o,target:t,config:i}),n.render.apply(t)}}))},destroy:function(){},updateRange:function(a){return this.each((function(){var t=e(this);if(t.data("waterBall")){var i=t.data("waterBall").config;i.targetRange=0,i.nowRange=0,i.isLoading=!1,setTimeout((function(){i.targetRange=a}),0)}}))},render:function(){var e=this.data("waterBall").config,c=this.data("waterBall").canvas,r=(e.wave_config.sX,e.wave_config.xOffset),o=e.backcolor_range[i.call(this)][0],l=e.backcolor_range[i.call(this)][1],g=e.main_backcolor_range[i.call(this)][0],f=e.main_backcolor_range[i.call(this)][1],h=c.getContext("2d"),s=t.call(this);if(e.nowRange<=e.targetRange){var d=1;e.nowRange+=d}if(e.nowRange>e.targetRange){d=1;e.nowRange-=d}var v=a.call(this,r+40,o,l),_=a.call(this,-40+r,g,f);h.clearRect(0,0,e.cvs_config.width,e.cvs_config.height),h.drawImage(s,0,0),h.drawImage(v,0,0),h.drawImage(_,0,0),delete s,delete v,delete _,e.wave_config.xOffset+=e.wave_config.speed,requestAnimationFrame(n.render.bind(this))}};e.fn.createWaterBall=function(a){return n[a]?n[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void e.error("Method "+a+"does not exits on jQuery.createWaterBall"):n.init.apply(this,arguments)}}(jQuery);
